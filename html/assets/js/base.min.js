"use strict";angular.module("bigUtil",[]).run(["$rootScope","$document",function(e,t){FastClick.attach(document.body),viewportUnitsBuggyfill.init();var n=e.$menu={active:!1,open:function(){n.active=!0},close:function(){n.active=!1},toggle:function(e){n.active=!n.active,e&&e.stopPropagation()}};t.on("click",function(){e.$apply(n.close)}),t.on("keyup",function(t){e.$apply(function(){27===t.keyCode&&n.close()})});var a=e.$modal={active:!1,open:function(e){a.active=e},close:function(){a.active=!1},toggle:function(e){a.active=a.active===e?!1:e},isOpen:function(e){return a.active===e}};e.$watch("$modal.active",function(e){angular.element(document.body).css({overflow:e?"hidden":""})}),t.on("keyup",function(t){e.$apply(function(){27===t.keyCode&&a.close()})})}]).filter("length",function(){return function(e){return angular.isArray(e)?e.length:angular.isObject(e)?Object.keys(e).filter(function(e){return"$"!=e[0]}).length:0}}).filter("unique",function(){return function(e,t){if(!e)return e;for(var n={},a=[],r=0;r<e.length;r++)n[angular.isFunction(t)?t(e[r]):e[r][t]]=e[r];for(var o in n)a.push(n[o]);return a}}).directive("bigClickToggle",["$parse",function(e){return{restrict:"A",link:function(t,n,a){var r=t.$eval(a.bigClickToggle);n.on("click",function(n){n.preventDefault(),t.$apply(function(){angular.forEach(r,function(n,a){return e(a).assign(t,n)})})}),angular.forEach(r,function(e,r){t.$watch(r,function(r){void 0!==r&&n[e===r?"addClass":"removeClass"](t.$eval(a.bigClickToggleActive)||"active")})})}}}]),angular.module("XXXXXX",["ui.router","ui.router.title","bigUtil","firebaseHelper","ngHandsontable"]).config(["$locationProvider","$urlRouterProvider","$urlMatcherFactoryProvider","$stateProvider","$firebaseHelperProvider","$provide",function(e,t,n,a,r){e.html5Mode(!0).hashPrefix("!"),t.when("","/"),t.when("/home","/"),t.when(/^\/competitions\/[^\/]+$/,"$0/settings"),n.strictMode(!1);var o=["home","competitions"];a.state("main",{"abstract":!0,templateUrl:"views/main.html"}).state("page",{parent:"main",url:"/{page:|"+o.join("|")+"}",templateUrl:function(e){return"views/page/"+(e.page||"home")+".html"},resolve:{$title:["$stateParams",function(e){switch(e.page){case"":case"home":return"";default:return e.page[0].toUpperCase()+e.page.slice(1)}}]}}).state("competition",{abtract:!0,parent:"page",url:"/:competitionId",templateUrl:"views/page/competition.html",resolve:{Sections:["$firebaseHelper",function(e){return e.array("sections")}],Competition:["$firebaseHelper","$stateParams",function(e,t){return e.object("competitions",t.competitionId)}],CompetitionData:["$firebaseHelper","$stateParams",function(e,t){return e.object("competitionsData",t.competitionId)}],$title:["Competition",function(e){return e.name}]},controller:["$scope","Sections","Competition","CompetitionData",function(e,t,n,a){e.sections=t,e.competition=n,e.competitionData=a}]}).state("competition.section",{url:"/:section",templateUrl:function(e){var t="";switch(e.section){case"settings":case"schedule":t=e.section;break;default:t="table"}return"views/page/competition/"+t+".html"},controller:["$scope","$stateParams","$firebaseHelper","Sections","Competition","CompetitionData",function(e,t,n,a,r,o){var i=t.section,c=function(e){return e?moment(r.date).diff(e,"years"):void 0};switch(i){case"settings":break;case"schedule":break;default:var u=e.hot=n.hot(o,i);n.load(a).then(function(t){switch(u.settings=angular.copy(angular.extend(t.settings||{},t[i]||{})),i){case"dances":n.array(o,"levels").$loaded(function(e){angular.forEach(e,function(e){u.settings.columns.push({data:e.name,title:e.name,type:"checkbox",uncheckedTemplate:""})})});break;case"dancers":u.settings.columns.push({data:"dob",title:"(Age)",type:"age",readOnly:!0});break;case"groups":n.array(o,"dancers").$loaded(function(t){var a={};angular.forEach(t,function(e){var t=c(e.dob);a[t]=a[t]||{},a[t][e.level]=(a[t][e.level]||0)+1});var r=[];angular.forEach(a,function(e,t){e.age=t,r.push(e)});var i={columns:[{data:"age",title:"Age",readOnly:!0}]};n.array(o,"levels").$loaded(function(e){angular.forEach(e,function(e){i.columns.push({data:e.name,title:e.name,type:"numeric",readOnly:!0})})}),e.helperHot={data:r,settings:i},u.settings.columns.push({title:"(# Dancers)",data:"$dancersCount",type:"numeric",readOnly:!0}),u.onData(function(e){angular.forEach(e,function(e){for(var t=parseInt(e.min);t<=parseInt(e.max);t++)e.$dancersCount||(e.$dancersCount=0),a[t]&&(e.$dancersCount+=parseInt(a[t][e.level])||0)})})}),e.generateGroups=function(e,t){t.data=[],n.array(o,"levels").$loaded(function(n){angular.forEach(n,function(n){n.$counter=n.$counted=n.$min=n.$max=0,angular.forEach(e,function(a,r){n.$counter+=a[n.name]||0,n.$min||(n.$min=a.age),n.$counter>=1&&n.$counted>=1||r>=e.length-1?(n.$max=a.age,t&&t.data&&t.data.push({level:n.name,min:n.$min,max:n.$max}),n.$counter=n.$counted=n.$min=n.$max=0):n.$counted++})})})}}angular.forEach(u.settings.columns,function(e){"age"===e.type?(e.type="numeric",e.renderer=function(e,t,n,a,r,o,i){var u=c(o);return Handsontable.renderers.NumericRenderer(e,t,n,a,r,u,i),t}):"level"===e.data&&n.array(o,"levels").$loaded(function(t){var n=[];angular.forEach(t,function(e){return n.push(e.name)}),e.source=n})})})}}]}).state("404",{parent:"main",templateUrl:"views/page/404.html"}),t.otherwise(function(e,t){var n=e.get("$state");return n.go("404",null,{location:!1}),t.path()}),r.namespace("scotdance")}]).controller("AppCtrl",["$rootScope","$scope","$state","$firebaseHelper","$timeout",function(e,t,n,a,r){e.$state=n,a.hot=function(){var e={ref:a.ref.apply(this,arguments),parseData:function(t){r(function(){var n=t.exportVal(),a=Object.keys(n||{}).map(function(e){var t=angular.copy(n[e]);return t.$id=e,t});e.original=angular.copy(a),e.revisions||(e.data=a,angular.isFunction(e.callback)&&e.callback(e.data)),e.revisions++})},callback:null,onData:function(t){e.callback=t},init:function(){e.ref.orderByPriority().on("value",e.parseData)},reload:function(){e.revisions=0,e.ref.orderByPriority().once("value",e.parseData)},save:function(){var t={};e.data.forEach(function(n){var a=n.$id||e.ref.push().key(),r=angular.copy(n);delete r.$id,angular.forEach(r,function(e,t){(""===e||t.match(/^[^\w\d_]/))&&delete r[t]}),t[a]=r}),e.revisions=0,e.ref.set(t,e.reload)},dirty:function(){if(e.data&&e.original){var t=e.data.filter(function(e){var t=!1;return angular.forEach(e,function(e){return t=t||e}),t});return!angular.equals(t,e.original)}},revisions:0,data:[]};return e.init(),e}}]).controller("CompetitionsCtrl",["$scope","$firebaseHelper",function(e,t){e.competitions=t.array("competitions")}]).directive("input",function(){return{restrict:"E",require:"?ngModel",link:function(e,t,n,a){switch(n.type){case"date":a.$formatters.push(function(e){return new Date(moment(e).format())}),a.$parsers.push(function(e){return moment(new Date(e)).format()});break;case"number":case"range":a.$formatters.push(function(e){return e||0}),a.$parsers.push(function(e){return parseFloat(e)||0})}}}});